<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi Tienda</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  
  <link href="style.css" rel="stylesheet" />
</head>
<body>

  <header class="bg-primary p-3">
    <div class="container d-flex justify-content-between align-items-center">
      <h1 class="h3 m-0" style="color: var(--color-negro-claro);">Kompra Libre</h1>
      <nav>
        <a href="tienda.html" class="me-3">Tienda</a>
        <a href="categorias.html" class="me-3">CategorÃ­as</a>
        <a href="usuario.html" class="me-3">Usuario</a>
        <a href="admin.html">Admin</a>
      </nav>
    </div>
  </header>

  <section class="py-3 bg-light">
    <div class="container">
      <input type="text" class="form-control" placeholder="Buscar productos..." id="buscador">
    </div>
  </section>

  <main class="container my-4">
    <div class="row" id="productosContainer">

    </div>
  </main>

  <section class="container mb-5">
    <h3>ðŸ›’ Carrito de compras</h3>
    <ul class="list-group mb-3" id="carritoLista"></ul>
    <p><strong>Total:</strong> $<span id="totalCarrito">0</span></p>
    <button class="btn btn-success mt-3" onclick="finalizarCompra()">Realizar compra</button>
    <p id="mensajeCompra" class="mt-3 text-success fw-bold"></p>
  </section>

  <footer class="bg-dark text-white text-center py-3">
    <p>Â© 2025 Kompra Libre. Todos los derechos reservados.</p>
  </footer>

  <script>
    let productos = JSON.parse(localStorage.getItem("productos")) || [];

    if (productos.length === 0) {
      productos = [
        {
          id: 1,
          nombre: "Cortadora de CÃ©sped",
          precio: 15000,
          imagen: "img/Cortadora de Cesped.jpg"
        },
        {
          id: 2,
          nombre: "Taladro ElÃ©ctrico",
          precio: 1500,
          imagen: "img/Taladro.jpg"
        },
        {
          id: 3,
          nombre: "Destornillador",
          precio: 800,
          imagen: "img/Destornillador.jpg"
        }
      ];
      localStorage.setItem("productos", JSON.stringify(productos));
    }

    const carrito = [];
    const productosContainer = document.getElementById("productosContainer");
    const carritoLista = document.getElementById("carritoLista");
    const totalCarrito = document.getElementById("totalCarrito");
    const mensajeCompra = document.getElementById("mensajeCompra");

    function renderizarProductos() {
      productosContainer.innerHTML = "";
      productos.forEach(producto => {
        const col = document.createElement("div");
        col.className = "col-md-4 mb-4";
        col.innerHTML = `
          <div class="card">
            <img src="${producto.imagen}" class="card-img-top" alt="${producto.nombre}">
            <div class="card-body">
              <h5 class="card-title">${producto.nombre}</h5>
              <p class="card-text">$${producto.precio}</p>
              <button class="btn btn-primary" onclick="agregarAlCarrito(${producto.id})">Agregar al carrito</button>
            </div>
          </div>
        `;
        productosContainer.appendChild(col);
      });
    }

    function agregarAlCarrito(id) {
      const producto = productos.find(p => p.id === id);
      if (!producto) return;

      const itemCarrito = carrito.find(item => item.producto.id === id);
      if (itemCarrito) {
        itemCarrito.cantidad++;
      } else {
        carrito.push({ producto, cantidad: 1 });
      }
      renderizarCarrito();
    }

    function cambiarCantidad(index, nuevaCantidad) {
      if (nuevaCantidad <= 0 || isNaN(nuevaCantidad)) {
        carrito.splice(index, 1);
      } else {
        carrito[index].cantidad = nuevaCantidad;
      }
      renderizarCarrito();
    }

    function renderizarCarrito() {
      carritoLista.innerHTML = "";
      let total = 0;

      carrito.forEach(({ producto, cantidad }, index) => {
        total += producto.precio * cantidad;
        const item = document.createElement("li");
        item.className = "list-group-item d-flex justify-content-between align-items-center";

        item.innerHTML = `
          <div>
            ${producto.nombre} - $${producto.precio} x 
            <input type="number" min="1" value="${cantidad}" style="width:60px;" onchange="cambiarCantidad(${index}, parseInt(this.value))">
          </div>
          <div>
            $${producto.precio * cantidad}
            <button class="btn btn-sm btn-danger ms-2" onclick="eliminarDelCarrito(${index})">Eliminar</button>
          </div>
        `;
        carritoLista.appendChild(item);
      });

      totalCarrito.textContent = total;
    }

    function eliminarDelCarrito(index) {
      carrito.splice(index, 1);
      renderizarCarrito();
    }

    function finalizarCompra() {
      if (carrito.length === 0) {
        mensajeCompra.textContent = "El carrito estÃ¡ vacÃ­o.";
        mensajeCompra.classList.replace("text-success", "text-danger");
        return;
      }

      const compraFinal = carrito.map(p => ({
        producto: p.producto.nombre,
        precio: p.producto.precio,
        cantidad: p.cantidad,
        subtotal: p.producto.precio * p.cantidad
      }));

      localStorage.setItem("compraFinalizada", JSON.stringify(compraFinal));
      mensajeCompra.textContent = "Â¡Compra realizada! Ve a la secciÃ³n Usuario para ver tu historial.";
      mensajeCompra.classList.replace("text-danger", "text-success");

      carrito.length = 0; 
      renderizarCarrito();
    }

    renderizarProductos();
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
